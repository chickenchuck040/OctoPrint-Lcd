#: kivy 1.9.0

#:import Server octoprint.server
#:import datetime datetime

#<Label>:
    #font_name: '/home/tim/python/kivy/OctoPrint-Lcd/octoprint_lcd/ui/fonts/Ubuntu-M.ttf'
    #font_name: 'fonts/Ubuntu-M.ttf'

<TimeLabel@BoxLayout>:
    time: "00:00:00"
    title: "No Time"

    spacing: 2
    orientation: 'vertical'


    Label:
        text: root.title
        font_size: 24
        size_hint: 1, None
        text_size: self.width, None
        size: self.texture_size[0], self.texture_size[1]
        halign: 'center'

    Label:
        text: root.time
        font_size: 36
        size_hint: 1, None
        text_size: self.width, None
        size: self.texture_size[0], self.texture_size[1]
        halign: 'center'
        #padding: 5, 10

<TemperatureLabel@BoxLayout>:
    actual: "-"
    target: "-"
    title: ""

    spacing: 2
    padding: 5

    Label:
        text: root.title
        font_size: 24
        size_hint: 0.3, None
        text_size: self.width, None
        size: self.texture_size[0], self.texture_size[1]
        halign: 'right'

    Label:
        text: root.actual + " " + unichr(176) + "C"
        font_size: 24
        size_hint: 0.3, None
        text_size: self.width, None
        size: self.texture_size[0], self.texture_size[1]
        halign: 'right'

    Label:
        text: root.target + " " + unichr(176) + "C"
        font_size: 24
        size_hint: 0.3, None
        text_size: self.width, None
        size: self.texture_size[0], self.texture_size[1]
        halign: 'right'
    Label:
        size_hint: 0.1, 1

<FilamentLabel@BoxLayout>:
    length: " - - "
    volume: " - - "
    title: ""

    spacing: 2
    padding: 5
    #orientation: 'vertical'

    Label:
        text: root.title
        font_size: 24
        size_hint: 0.4, None
        text_size: self.width, None
        size: self.texture_size[0], self.texture_size[1]
        halign: 'right'

    Label:
        text: root.length + "m"
        font_size: 24
        size_hint: 0.25, None
        text_size: self.width, None
        size: self.texture_size[0], self.texture_size[1]
        halign: 'right'
    Label:
        text: root.volume + "cm" + unichr(179)
        font_size: 24
        size_hint: 0.35, None
        text_size: self.width, None
        size: self.texture_size[0], self.texture_size[1]
        halign: 'right'
    Label:
        size_hint: 0, 1

<StatusTab>:
    BoxLayout:
        orientation: 'vertical'
        Label:
            id: status_label
            text: 'Printing'
            halign: 'center'
            font_size: 48
            text_size: root.width, 60
            size: self.texture_size
            size_hint: 1, None
        Label:
            id: file_label
            text: 'Everything.gcode'
            halign: 'center'
            font_size: 24
            text_size: root.width, 40
            size: self.texture_size
            size_hint: 1, None
        BoxLayout:
            #size: self.width, self.height
            #size_hint: 1, None
            padding: 10
            BoxLayout:
                orientation: 'vertical'
                TemperatureLabel:
                    id: bed_status
                    title: "Bed:"
                TemperatureLabel:
                    id: tool0_status
                    title: "Tool 0:"
                TemperatureLabel:
                    id: tool1_status
                    title: "Tool 1:"
                TemperatureLabel:
                    id: tool2_status
                    title: "Tool 2:"

            BoxLayout:
                orientation: 'vertical'
                #size_hint: 0.6, 1
                FilamentLabel:
                    id: tool0_filament
                    title: "Tool 0 Usage: "
                FilamentLabel:
                    id: tool1_filament
                    title: "Tool 1 Usage: "
                FilamentLabel:
                    id: tool2_filament
                    title: "Tool 2 Usage: "

        BoxLayout:
            #orientation: 'vertical'
            size: self.width, 70
            size_hint: 1, None
            TimeLabel:
                id: time_in
                time: "12:34:54"
                title: 'Printed'
            TimeLabel:
                id: time_remaining
                time: "10:47:32"
                title: 'Remaining'
            TimeLabel:
                id: time_total
                time: "22:21:12"
                title: 'Total'
        ProgressBar:
            id: progress
            max: 100
            value: 56
            padding: 5
            size: self.width, 30
            size_hint: 1, None
        BoxLayout:
            size_hint: 1, None
            size: self.width, 40
            size_hint: 1, None
            size: self.width, 40
            Button:
                text: "Print"
                id: print_button
                on_press: Server.printer.start_print()
            Button:
                text: "Pause"
                id: pause_button
                on_press: Server.printer.toggle_pause_print()
            Button:
                text: "Cancel"
                id: cancel_button
                on_press: Server.printer.cancel_print()
                background_color: 2, .5, .5, 1

<FileView>:
    title: ""
    date: "0"

    orientation: 'vertical'
    padding: 5, 10

    canvas.before:
        Color:
            rgba: 0.4, 0.4, 0.4, 1
        Rectangle:
            pos: self.pos
            size: self.size
        Color:
            rgba: 0.5, 0.5, 0.5, 1
        Line:
            points: self.pos[0]+15, self.pos[1], self.pos[0]+self.width-15, self.pos[1]

    Label:
        text: root.title
        font_size: 24
        size_hint: 1, 0.6
        text_size: self.width, None
        size: self.texture_size[0], self.texture_size[1]
        halign: 'center'
    BoxLayout:
        Label:
            text: datetime.datetime.fromtimestamp(int(root.date)).strftime('%a, %b %-d, %Y')
            font_size: 16
            size_hint: 1, 0.4
            text_size: self.width, None
            size: self.texture_size[0], self.texture_size[1]
            halign: 'left'
        Label:
            text: datetime.datetime.fromtimestamp(int(root.date)).strftime('%-I:%M:%S%p')
            font_size: 16
            size_hint: 1, 0.4
            text_size: self.width, None
            size: self.texture_size[0], self.texture_size[1]
            halign: 'right'

<FilesTab>:
    title: "No File"
    date: ""
    etime: "00:00:00"
    ltime: "00:00:00"
    tool0l: ""
    tool1l: ""
    tool2l: ""
    tool0v: ""
    tool1v: ""
    tool2v: ""

    BoxLayout:
        size_hint_x: 0.55
        BoxLayout:
            orientation: 'vertical'
            Label:
                text: root.title
                font_size: 36
                size_hint: 1, None
                text_size: self.width, None
                size: self.texture_size[0], self.texture_size[1]
                halign: 'center'
                padding: 0, 15

            BoxLayout:
                size_hint_y: 0.2
                padding: 10
                Label:
                    text: "" if root.date == "" else datetime.datetime.fromtimestamp(int(root.date)).strftime('%a, %b %-d, %Y')
                    font_size: 24
                    size_hint: 0.6, 1
                    text_size: self.width, None
                    size: self.texture_size[0], self.texture_size[1]
                    halign: 'left'
                Label:
                    text: "" if root.date == "" else datetime.datetime.fromtimestamp(int(root.date)).strftime('%-I:%M:%S%p')
                    font_size: 24
                    size_hint: 0.4, 1
                    text_size: self.width, None
                    size: self.texture_size[0], self.texture_size[1]
                    halign: 'right'

            BoxLayout:
                size_hint_y: 0.4
                padding: 10
                TimeLabel:
                    size_hint_y: 0.4
                    time: root.etime
                    title: 'Estimated'

            BoxLayout:
                size_hint_y: 0.05

            BoxLayout:
                orientation: 'vertical'
                padding: 10
                size_hint_y: 0.5
                FilamentLabel:
                    volume: root.tool0l
                    length: root.tool0v
                    title: "Tool 0 Usage: "
                FilamentLabel:
                    volume: root.tool1l
                    length: root.tool1v
                    title: "Tool 1 Usage: "
                FilamentLabel:
                    volume: root.tool2l
                    length: root.tool2v
                    title: "Tool 2 Usage: "

            BoxLayout:
                size_hint_y: 0.25

            BoxLayout:
                size_hint: 1, None
                size: self.width, 40
                size_hint: 1, None
                size: self.width, 40
                Button:
                    text: "Print"
                    id: print_button
                    on_press: Server.printer.select_file(Server.fileManager.path_on_disk('local', root.title), False, printAfterSelect=True)
                Button:
                    text: "Load"
                    id: pause_button
                    on_press: Server.printer.select_file(Server.fileManager.path_on_disk('local', root.title), False)
                Button:
                    text: "Delete"
                    id: cancel_button
                    on_press: Server.fileManager.remove_file('local', root.title)
                    background_color: 2, .5, .5, 1

    BoxLayout:
        orientation: 'vertical'
        size_hint_x: 0.45
        Label:
            text: "Files:"
            font_size: 36
            size_hint: 1, None
            text_size: self.width, None
            size: self.texture_size[0], self.texture_size[1]
            halign: 'center'
            padding: 0, 15
        ScrollView:
            size: self.size
            GridLayout:
                id: file_list
                size_hint_y: None
                cols: 1
                spacing: 0, 0
                padding: 0, 0

<OctoprintLcd>:
    pos_hint: {'center_x': .5, 'center_y': .5}
    do_default_tab: False

    TabbedPanelItem:
        text: 'Status'
        StatusTab:
            id: status_tab

    TabbedPanelItem:
        text: 'tab2'
        BoxLayout:
            Label:
                text: 'Second tab content area'
            Button:
                text: 'Button that does nothing'
    TabbedPanelItem:
        text: 'Files'
        FilesTab:
            id: files_tab
